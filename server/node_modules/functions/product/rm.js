//
//
// by : mostafa

var db = require('db');

module.exports = function remove_product(product_id, cb) {

  cb = cb || function() {};

  if (!product_id) {
    cb({
      status: 400,
      message: "low args"
    });
  } else {

    // TODO check product in not invoice
    db.products.remove({
      _id: product_id
    }).lean().exec(function(err, res) {
      if (err) {
        cb({
          status: 500,
          error_obj: err
        });
      } else if (res) {
        db.operations.remove({
          'items.product_id': product_id,
          type: 'first_period'
        }).exec(function(err, _r) {
          if (err) throw err;
          if (_r) {
            cb(null, true);
            // removed
          }
        })
      }
    });
  }
}
