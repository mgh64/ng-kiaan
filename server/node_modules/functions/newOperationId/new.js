//
//
var db = require('db');
var mongoose = require('mongoose');
var miladi_code = require('functions/miladi_code');


module.exports = function(cb) {

  cb = cb || function() {};

  db.operations.find({}, {
    id: 1,
    _id: 0
  }).sort({
    _id: -1
  }).limit(1).lean().exec(function(err, id) {
    if (err) {
      return cb(err);
    }

    if (id && id[0] && id[0].id) {
      miladi_code(function(r) {
        // console.log('s => ' + String((id[0].id)).substring(0, 7));
        // console.log('r => ' + r);
        if (r == String((id[0].id)).substring(0, 7)) {
          // console.log('1');
          return cb(null, r + (Number(String((id[0].id)).substring(7)) + 1));
        } else {
          // console.log('2');
          return cb(null, r + '1')
        }
      })
    } else {
      // console.log('3');
      miladi_code(function(r) {
        return cb(null, r + '1')
      })
    }
  });

}
